## 初识HTTP

TCP/IP协议按层次分为**应用层、传输层、网络层、数据链路层**

* **应用层**：决定了向用户提供应用服务时通信的行为，HTTP就处于该层。
* **传输层**：对于上层应用层，传输层提供了处于网络连接中的两台计算机之前的数据传输
    * 在传输层有两个性质不同的协议
      1. TCP（Transmission Control Protocol）传输控制协议
      2. UDP（User Data Protocol）用户数据报协议
      
* **网络层**：处理网络上流动的数据包，该层规定通过什么样的路径到达对方的计算机，将数据传给对方
* **数据链路层（网络接口层）**：处理连接网络的硬件部分

### TCP/IP通信传输流

* 客户端 -> 服务器

    应用层 -> 传输层 -> 网络层 -> 链路层 --------> 链路层 -> 网络层 -> 传输层 -> 应用层

  *相反也是一样的*

### 与HTTP关系密切的TCP IP DNS
  IP（Internet Protocol）网际协议，位于网络层
  TCP协议位于传输层
    握手过程使用了TCP的标记 -----SYN和ACK
    三次握手
      
      发送端 ----->(SYN)接收端    
      发送端 <-----(SYN/ACK)接收端
      发送端 ----->(ACK)接收端
###  负责域名解析的DNS，位于应用层，提供了域名到IP地址之间的解析服务
  
### HTTP与其他协议的关系
![HTTP与其他协议关系](www.dapanpro.com)

### URL 和 URI
* URI(统一资源标识符)
	1. Unifrom：统一的格式方便处理不同类型的资源
	2. Resource：资源的定义就是“可标识的任何东西“，除了文档文件、图片或服务等能够区别于其他类型的，都可作为资源。
	3. Identifier：可标识的对象，也称为标识符
	
	综上所述，URI就是由某个协议方案表示的资源的定位标识符，协议方案是指访问资源所使用的协议类型名称
	
	使用HTTP协议时，协议方案就是http，还有ftp、file等
	
	URI用字符串标识某一互联网资源，URL标识资源的地址。URL是URI的子集
	
	**URI格式**
	
	表示指定的URI，要使用涵盖全部必要信息的绝对URI、绝对URL以及相对URL。相对URL是指从浏览器中基本URI处指定的URL，形如 */images/test.jpg*
	
	绝对URI格式：http://user:pwd@www.example.com:80/dir/index.html?uid=1#ch1
	
	RFC(Request for Comments, 征求修正意见书) ====> 用来制定HTTP协议技术标准的文档
* URL(统一资源定位符) 

## 简单的HTTP协议

### HTTP协议用户客户端和服务器端之间的通信

请求访问文本或图像等资源的一端称为客户端，而提供资源响应的为服务器端

**请求报文**是由*请求方法*、*请求URI*、*协议版本*、*可选的请求首部字段*、*内容实体*构成

**响应报文**是由*协议版本*、*状态码*、*用以解释状态码的原因短语*、*可选的响应首部字段*、*实体主体*构成

HTTP是**无状态**协议 

### HTTP协议方法：

* GET
* POST
* PUT（传输文件）
* HEAD（获得报文首部，用于确认URI有效性和资源更新的时间）
* DELETE（删除文件）
* OPTIONS（询问查询的方法）
* TRACE（追踪路径）
* CONNECT（用隧道协议连接代理）

### 使用方法下达命令

* 向请求URI指定的资源发送请求报文时，采用称为方法的命令
* 方法的作用是可以指定请求的资源按照期望产生某种行为

### 持久连接节省通信量

* 持久连接
	1. 特点：只要任意一端没有明确提出断开连接，则保持TCP连接状态
* 管线化： 不用等待响应亦可直接发送下一个请求  

### 使用Cookie的状态管理

## HTTP报文内的HTTP信息

### HTTP报文：

* 定义：用于HTTP协议交互的信息
* 请求报文：客户端的HTTP报文
* 响应报文：服务器端的HTTP报文
* 通常分为报文首部和报文主体，两者由最初出现的空行来划分。通常，并不一定有报文主体
	1. 服务器端或客户端需处理的响应或请求的内容和属性

### 请求报文和响应报文的结构
```html
<table>
    <tr>
      <td rowspan='5'>报文首部</td>
      <td>请求行</td>
   </tr>
   <tr>
     
      <td>请求首部字段</td>
   </tr>
   <tr>
      
      <td>通用首部字段</td>
   </tr>
   <tr>
      <td>实体首部字段</td>
   </tr>
   <tr>
      <td>其他</td>
   </tr>
   <tr>
      <td>空行（CR + LF）</td>
      <td></td>
   </tr>
	<tr>
	   <td>报文主体</td>
	   <td></td>
	</tr>
</table>

<table>
   <tr>
      <td rowspan='5'>报文首部</td>
      <td>状态行</td>
   </tr>
   <tr>
     
      <td>响应首部字段</td>
   </tr>
   <tr>
      
      <td>通用首部字段</td>
   </tr>
   <tr>
      <td>实体首部字段</td>
   </tr>
   <tr>
      <td>其他</td>
   </tr>
   <tr>
      <td>空行（CR + LF）</td>
      <td></td>
   </tr>
	<tr>
	   <td>报文主体</td>
	   <td></td>
	</tr>
</table>

```

请求行：包含用于请求的方法、请求URI和HTTP版本

状态行：包含表明响应结果的状态码，原因短语和HTTP版本

首部字段：包含表示请求和响应的各种条件和属性的各类首部

* 一般有四种首部： 通用首部、请求首部、响应首部、实体首部

其他：可能包含HTTP的RFC里未定义的首部（Cookie等）

### 编码提升传输速率

HTTP在传输数据时可以按照数据原貌直接传输，但也可以在传输过程中通过编码提升传输速率。通过在传输时编码，能有效的处理大量的访问请求。但是，编码的操作需要计算机来完成，因此会消耗更多的CPU等资源

#### 报文主体和实体主体的差异

* 报文：是HTTP通信中的基本单位，由八位组字节流组成，通过HTTP通信传输
* 实体：作为请求或相应的有效荷载数据被传输，其内容由实体首部和实体主体组成

HTTP的报文主体用于传输请求或响应的实体主体

通常报文主体等于实体主体，只有当传输中进行编码操作是，实体主体内容会发生变化，导致与保温主体的差异

#### 压缩传输的内容编码
HTTP协议中有一种叫内容编码的功能将内容压缩后传输，常见的内容编码：

* gzip（GNU zip）
* compress（UNIX系统的标准压缩）
* deflate（）
* identity（不进行编码）

#### 分割发送的分块传输编码
传输大容量数据时，把数据分割成多块，能够让浏览器逐步显示页面

### 发送多种数据的多部分对象集合

多部分对象集合包含的对象如下：

* multipart/form-data ----- Web表单文件上传使用
* multipart/byteranges ----- 状态码206响应报文包含了多个范围的内容时使用

多部分对象集合的每个部分类型中，都可以含有首部字段。

### 获取部分内容的范围请求

指定范围发送的请求叫做范围请求

在执行范围请求时，会用到首部字段Range

针对范围请求，响应会返回206 Partial Content的响应报文。另外，对于多重范围的范围请求，响应会在首部字段Contenty-Type标明multipart/byteranges后返回响应报文。

如果服务器无法响应范围请求，则会返回状态码200OK和完整的实体内容。

### 内容协商返回最合适的内容

内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为合适的资源。内容协商会以响应资源的语言、字符集、编码方式等作为判断的基准

包含在请求报文中的某些首部字段（如下）就是判断的基础
 
 * Accept
 * Accept-Charset
 * Accept-Encoding
 * Accept-Language
 * Content-Langugae

内容协商技术有一下三种类型

* 服务器驱动协商（Server-driven Negotiation）
* 客户端驱动协商（Agent-driven Negotiation）
* 透明协商（Transparent Negotiation）

## 返回结果的HTTP状态码

HTTP状态码负责表示客户端HTTP请求的返回结果、标记服务器端的处理是否正常、通知出现的错误等工作

### 状态码告知从服务器端返回的请求结果

状态码的类别

|      | 类别                         | 原因短语                  |
|----- | --------------------------- | ----------------         | 
|1XX   | Informational(信息性状态码)   | 接收的请求正在处理          |
|2XX   | Success(成功状态码)           | 请求正常处理完毕           |
|3XX   | Redirection(重定向状态码)     | 需要进行附加操作已完成请求   |
|4XX   | Client Error(客户端错误状态码) | 服务器无法处理请求          |
|5XX   | Serve Error(服务器错误状态吗)  | 服务器处理请求错误          |

14个常见的状态码

### 2XX 成功
#### 200 OK
从客户端发出的请求在服务器端被正常处理
#### 204 No Content
服务器接收的请求已成功处理，但返回的报文中不含实体的主体部分
#### 206 Partial Content
客户端进行了范围请求。响应报文中包含有Content-Range指定范围的实体内容

### 3XX重定向
3XX响应结果表明浏览器需要执行某些特殊的处理以正确处理请求
#### 301 Moved Permanently
永久性重定向。该状态码表示请求的资源一杯分配了新的URI，以后应使用资源现在所指的URI
#### 302 Found
临时性重定向。改状态码表示请求的资源已被分配到了新的URL，希望用户（本次）能使用新的URI访问
#### 303 See Other
该状态码表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求资源
#### 304 Not Modified
该状态码表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但为满足条件的情况

附带条件的请求值得是采用GET请求方法的请求报文中包含If-Match,If-Modified-Since,If-None-Match,If-Range,If-Unmodified-Sicne中任一首部
#### 307
临时重定向，与302有相同含义

### 4XX客户端错误
4XX的响应结果表明客户端是发生错误的原因所在。
#### 400 Dad Request
请求报文中存在语法错误。
#### 401 Unnauthorized
请求需要有通过HTTP认证的认证信息，若之前已经进行过一次请求，则表示用户认证失败。返回401的响应必须包含一个适用于被请求资源的WWW-Authenticate首部以质询用户信息。当浏览器初次接收到401响应，会弹出认证的对话窗口。
#### 403 Forbidden
该状态码表明对请求资源的访问被服务器拒绝了。

未获得文件系统的访问授权，访问权限出现某些问题（从未授权的发送源IP地址试图访问）等情况都可能是403的原因

#### 404 Not Found
服务器上无法找到请求的资源。也可以在服务器端拒绝请求且不想说明理由时使用

### 5XX服务器错误
5XX的响应结果表明服务器本身发生错误
#### 500 Internal Server Error
服务器端在执行请求是发生了错误。也有可能是Web应用存在的bug或某些临时的故障
#### 503 Service Unavailable
服务器暂时处于超负载或正在进行停机维护，现在无法进行请求。如果得知解除以上状况需要的时间，最好写入RetryAfter首部字段再返回给客户端


 	